; just delay!

(defn constant [val]
  (fn [vars] val))
(defn variable [name]
  (fn [vars] (vars name)))

(defn make-op [op-impl]
  (fn [& args]
    (fn [vars]
      (apply op-impl
             (mapv (fn [arg] (arg vars)) args)))))

(def add (make-op +))
(def subtract (make-op -))
(def multiply (make-op *))
(def divide (make-op #(if (zero? %2) ##Inf (/ (double %1) (double %2)))))
(def negate (make-op #(- 0 %1)))
(def med (make-op (fn [& args] (nth (sort args) (int (/ (count args) 2))))))
(def avg (make-op (fn [& args] (/ (apply + args) (count args)))))

(def operators
  {'+ add '- subtract '* multiply '/ divide 'negate negate 'med med 'avg avg})
(defn parse-funs [expr]
  (cond
    (list? expr) (apply (operators (first expr)) (map parse-funs (rest expr)))
    (number? expr) (constant expr)
    :else (variable (str expr))))
(def parseFunction (comp parse-funs read-string))

(def expr (avg (avg (variable "y") (subtract (constant 1534645335.0) (variable "y")) (variable "y") (avg (variable "x") (variable "x") (constant -1839982030.0) (constant -1595555966.0
                                                                                                                                                                          ) (variable "x")) (avg (variable "x") (variable "x") (variable "x") (constant 315852483.0) (variable "y"))) (variable "x") (divide (med (variable "y") (variable "y") (variable "x")) (med
                                                                                                                                                                                                                                                                                                                                                                  (variable "y") (divide (constant -1284181468.0) (variable "z")) (med (constant -1338213491.0) (constant 2024381968.0) (constant 981272776.0)))) (divide (divide (subtract (avg (subtract
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   (constant -1649264577.0) (variable "y")) (constant 499252114.0) (variable "y") (constant -1237813636.0) (constant -1778360162.0)) (avg (constant 407500148.0) (multiply (variable "y") (constant -1064973763.0)) (constant -780878466.0) (avg (subtract (variable "y") (constant 1482958355.0)) (variable "y") (variable "y") (subtract (constant -385167497.0) (variable "z")) (constant -674760064.0)) (add (variable "z") (add (med (constant 1326802466.0) (constant -1589865582.0) (variable "z")) (variable "z"))))) (variable "y")) (avg (multiply (variable "y") (variable "x")) (divide (constant -1453316789.0) (constant -1298989924.0)) (variable "x") (divide (variable "z") (avg (constant 1328072771.0) (constant 1973908966.0) (constant -494230021.0) (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      variable "z") (variable "y"))) (variable "z"))) (add (subtract (med (med (variable "z") (constant 1645328750.0) (variable "y")) (divide (constant -887280224.0) (variable "x")) (divide (s
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ubtract (constant -1034463488.0) (variable "x")) (subtract (variable "z") (variable "z")))) (med (constant 1535901655.0) (med (avg (add (constant 1648602096.0) (constant 230168187.0)) (v
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          ariable "x") (med (variable "x") (variable "y") (variable "z")) (subtract (variable "x") (variable "z")) (constant -1032590161.0)) (divide (variable "y") (variable "z")) (add (constant -
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   1964961993.0) (multiply (constant 737025074.0) (variable "y")))) (add (med (subtract (multiply (variable "z") (variable "x")) (add (variable "z") (constant 1729424937.0))) (avg (avg (con
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           stant 173413420.0) (constant -425963591.0) (constant -1059131663.0) (variable "z") (multiply (avg (constant 862547516.0) (variable "x") (constant 479424838.0) (constant 133752980.0) (con
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   stant -1827197889.0)) (subtract (constant 923707684.0) (constant 619240895.0)))) (add (avg (constant 1977095130.0) (variable "y") (constant -746719222.0) (constant -1449688787.0) (consta
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        nt -1733837901.0)) (variable "y")) (multiply (variable "x") (constant 459683594.0)) (divide (variable "y") (constant -895205285.0)) (add (variable "x") (med (constant 969788126.0) (const
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              ant 762841016.0) (variable "y")))) (subtract (med (constant 1385507785.0) (variable "z") (variable "x")) (constant 112677937.0))) (add (add (constant 2081610015.0) (constant 666856081.0)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          ) (add (variable "x") (add (variable "x") (constant 1148073720.0))))))) (multiply (divide (divide (avg (variable "z") (constant 655015788.0) (variable "z") (variable "z") (variable "z"))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            (avg (add (variable "y") (constant -139405970.0)) (avg (divide (subtract (variable "x") (variable "x")) (med (constant 843709054.0) (variable "z") (constant 226846976.0))) (variable "z"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ) (add (constant 2130394685.0) (constant 1431903393.0)) (add (variable "x") (constant 315586158.0)) (subtract (med (variable "z") (variable "z") (constant 1401074905.0)) (constant 156523
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      9460.0))) (multiply (variable "x") (constant -1207404607.0)) (subtract (med (variable "y") (constant -997283968.0) (constant 129487792.0)) (variable "z")) (multiply (divide (divide (vari
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             able "y") (variable "z")) (subtract (constant 1389082153.0) (subtract (variable "x") (constant 100802118.0)))) (med (variable "y") (multiply (constant -1321582403.0) (variable "z")) (avg
(println (expr {"z" 0.6711699812566667, "x" 0.9233373885728978, "y" 0.9154301224659839}))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     (variable "x") (constant -2142672382.0) (variable "y") (variable "x") (constant 1219728326.0)))))) (multiply (avg (variable "x") (constant -1964032690.0) (constant -424279731.0) (constant 185885014.0) (constant -758267439.0)) (avg (add (variable "z") (constant -67670088.0)) (multiply (variable "z") (add (variable "z") (variable "y"))) (med (constant 697786155.0) (divid
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               e (constant -1064624060.0) (variable "z")) (avg (constant 77077170.0) (variable "x") (variable "y") (constant -1028753324.0) (constant -1684769548.0))) (constant 1169793547.0) (divide (v
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         ariable "z") (variable "x"))))) (subtract (divide (divide (constant 392699760.0) (variable "y")) (subtract (constant -945571111.0) (variable "y"))) (med (variable "x") (constant -1759612
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           867.0) (constant 1639177134.0)))))))